<html>

<head>
  <link rel="stylesheet" type="text/css" href="../css/app.css">
  <link rel="stylesheet" type="text/css" href="../css/animate.css">
</head>

<body>
  <div id="intro">
    <div class="logo animated fadeIn">
      <div class="title animated lightSpeedIn">MOVIE DRINKING GAME</div>
      <img class="beer animated rotateIn">
      <div class="ip animated slideInRight"></div>
      <button class="start animated bounceInUp">Start</button>
    </div>
  </div>

  <video id="movie" class="movie" controls>
    <source id='avi'
    src="file:///C:/Users/Ryan%20Mueller/Downloads/Hell%20Comes%20to%20Frogtown%20(1988)%20-%20720p/Hell.Comes.to.Frogtown.1988.720p.BluRay.x264.VPPV.mp4"
    type='video/mp4'>
    <p>Your user agent does not support the HTML5 Video element.</p>
  </video>

  <div class="overlay animated" style="display: none;">
    <div id="question">
  		<div class="badge">
  		  <img class="beer">
  		</div>
    	<div id="question-text"></div>
	   </div>

    <table>
      </tr>
      <tr>
        <td id="answer-0" class="answer"></td>
        <td id="answer-1" class="answer"></td>
      </tr>
      <tr>
        <td id="answer-2" class="answer"></td>
        <td id="answer-3" class="answer"></td>
      </tr>
    </table>

    <div class="timer"></div>
  </div>

  <script>
    const $ = require('jquery');
    const os = require('os');
    const interfaces = os.networkInterfaces();

    $('.ip').html(interfaces['Wi-Fi'][1].address + ':3001');

    $('.start').click(function () {
      $('#intro').fadeOut();
    })
  </script>

  <script>
    const {ipcRenderer} = require('electron');

    var movie = document.querySelector('.movie');
    var timer = $('.timer');

    movie.addEventListener('timeupdate', function () {
     ipcRenderer.send('movie-time', movie.currentTime);
    })

    ipcRenderer.on('show-question', function(event, question) {
      $('#question-text').html(question.text);

      showQuestion();
    });

    ipcRenderer.on('show-answers', function(event, answers, duration) {
      $('#answer-0').html('A) ' + answers[0]);
      $('#answer-1').html('B) ' + answers[1]);
      $('#answer-2').html('C) ' + answers[2]);
      $('#answer-3').html('D) ' + answers[3]);
      $('table').css('visibility', 'visible');

      startTimer(duration);
    });

    ipcRenderer.on('show-correct-answers', function(event, answers) {
      for (var i=0; i<answers.length; i++) {
        stopTimer();
        $('#answer-' + answers[i]).addClass('correct');
      }
    });

    ipcRenderer.on('hide-question', function(event) {
      hideQuestion();
      $('table').css('visibility', 'hidden');
      $('.correct').removeClass('correct');
    });
  </script>

  <script>
    let interval;

    function startTimer(duration) {
      var startTime = movie.currentTime;

      interval = setInterval(function() {
        var currentTime = movie.currentTime;
        var timerWidth = 95.7 - (95.7 * ((currentTime - startTime) / duration));
        timer.css('width', timerWidth + '%');
      }, 50);
    }

    function stopTimer() {
      clearInterval(interval);
    }

    function showQuestion() {
      var images = ['arnold', 'beer', 'cassette', 'champagne', 'confused', 'guitar', 'martini', 'shoes', 'vandamme', 'wine'];
      var index = Math.round(Math.random() * (images.length - 1));

      $('.badge img').attr('class', images[index]);

      var renderFunctions = [
        'bounceIn', 'bounceInDown', 'bounceInLeft', 'bounceInRight', 'bounceInUp',
        'fadeIn', 'fadeInDown', 'fadeInDownBig', 'fadeInLeft', 'fadeInLeftBig', 'fadeInRight', 'fadeInRightBig', 'fadeInUp', 'fadeInUpBig',
        'flipInX', 'flipInY',
        'lightSpeedIn',
        'rotateIn', 'rotateInDownLeft', 'rotateInDownRight', 'rotateInUpLeft', 'rotateInUpRight',
        'rollIn',
        'zoomIn', 'zoomInDown', 'zoomInLeft', 'zoomInRight', 'zoomInUp',
        'slideInDown', 'slideInLeft', 'slideInRight', 'slideInUp'
      ];

      var index = Math.round(Math.random() * (renderFunctions.length - 1));
      $('.overlay').attr('class', 'overlay animated').addClass(renderFunctions[index]).show();
    }

    function hideQuestion() {
      var renderFunctions = [
        'bounceOut', 'bounceOutDown', 'bounceOutLeft', 'bounceOutRight', 'bounceOutUp',
        'fadeOut', 'fadeOutDown',  'fadeOutDownBig', 'fadeOutLeft',  'fadeOutLeftBig',  'fadeOutRight', 'fadeOutRightBig',  'fadeOutUp', 'fadeOutUpBig',
        'flipOutX', 'flipOutY',
        'lightSpeedOut',
        'rotateOut', 'rotateOutDownLeft', 'rotateOutDownRight', 'rotateOutUpLeft', 'rotateOutUpRight',
        'rollOut',
        'zoomOut', 'zoomOutDown', 'zoomOutLeft', 'zoomOutRight', 'zoomOutUp',
        'slideOutDown', 'slideOutLeft', 'slideOutRight', 'slideOutUp'
      ];

      var index = Math.round(Math.random() * (renderFunctions.length - 1));
      $('.overlay').attr('class', 'overlay animated').addClass(renderFunctions[index]);
    }
  </script>

</body>
</html>
