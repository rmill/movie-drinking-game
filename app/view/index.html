<html>

<head>
<link rel="stylesheet" type="text/css" href="../css/app.css">
</head>

<body>

  <video id="movie" class="movie" controls>
    <source id='avi'
    src="file:///C:/Users/Ryan%20Mueller/Downloads/Hell%20Comes%20to%20Frogtown%20(1988)%20-%20720p/Hell.Comes.to.Frogtown.1988.720p.BluRay.x264.VPPV.mp4"
    type='video/mp4'>
    <p>Your user agent does not support the HTML5 Video element.</p>
  </video>

  <div class="overlay" style="display: none;">
    <div id="question">
  		<div class="badge">
  		  <img src="../img/beer.png">
  		</div>
    	<div id="question-text"></div>
	   </div>

    <table>
      </tr>
      <tr>
        <td id="answer-0" class="answer"></td>
        <td id="answer-1" class="answer"></td>
      </tr>
      <tr>
        <td id="answer-2" class="answer"></td>
        <td id="answer-3" class="answer"></td>
      </tr>
    </table>

    <div class="timer"></div>
  </div>

  <script>
    const {ipcRenderer} = require('electron');
    const $ = require('jquery');

    var movie = document.querySelector('.movie');
    var timer = $('.timer');

    movie.addEventListener('timeupdate', function () {
      ipcRenderer.send('movie-time', movie.currentTime);
    })

    ipcRenderer.on('show-question', function(event, question) {
      $('#question-text').html(question.text);
      $('.overlay').show();
    });

    ipcRenderer.on('show-answers', function(event, answers, duration) {
      $('#answer-0').html(answers[0]);
      $('#answer-1').html(answers[1]);
      $('#answer-2').html(answers[2]);
      $('#answer-3').html(answers[3]);
      $('table').css('visibility', 'visible');

      startTimer(duration);
    });

    ipcRenderer.on('show-correct-answers', function(event, answers) {
      for (var i=0; i<answers.length; i++) {
        stopTimer();
        $('#answer-' + answers[i]).addClass('correct');
      }
    });

    ipcRenderer.on('hide-question', function(event) {
      $('.overlay').hide();
      $('table').css('visibility', 'visible');
      $('.correct').removeClass('correct');
    });
  </script>

  <script>
    let interval;

    function startTimer(duration) {
      var startTime = movie.currentTime;

      interval = setInterval(function() {
        var currentTime = movie.currentTime;
        var timerWidth = 95.7 - (95.7 * ((currentTime - startTime) / duration));
        timer.css('width', timerWidth + '%');

      }, 50);
    }

    function stopTimer() {
      clearInterval(interval);
    }
  </script>

</body>
</html>
